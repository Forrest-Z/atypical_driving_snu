<!-- 
    test_with_virtual_environment.launch
-->

<launch>
  <arg name = "use_sim_time" value = "false"/>
<!--   <arg name="bagfile"        default="autoDriveIntegration.bag"/> -->
<!--   <arg name="bagfile"        default="autoDriveTwoBoxes.bag"/> -->
  <arg name = "pcl_topic" default = "/airsim_car_node/PhysXCar/lidar/LidarSensor1"/>

  <param name="use_sim_time" value="$(arg use_sim_time)"/>


<!-- Arguments Start -->
  <arg name="snu_frame_id" default="SNU"/>
  <arg name="occu_frame_id" default="SNU"/>
  <arg name="world_frame_id" default="map"/>
  <arg name="car_base_frame_id" default="/car_base_link"/>
  <arg name="lidar_frame_id" default = "LidarSensor1"/>
  <arg name ="detected_object_frame_id" default = "map"/>

  <param name = "smooth_weight" value="0.7"/>

  <arg name= "lane_width" default="10"/>
  <arg name = "lane_csv_file" default = "$(find atypical_driving)/lane/waypoint_airsim.csv"/>
  <arg name = "log_file_prefix" default= "$(find atypical_driving)/log/log" />
  <arg name = "waypoints" default="$(find atypical_driving)/param/goal_airsim.yaml"/>

  <arg name="vehicle_model/ly"            default="2.7"/> <!-- for the dynamics -->
  <arg name="vehicle_model/lx"            default="2"/> <!-- for safe margin -->
  <arg name="vehicle_model/is_rear_wheel"     default="true"/>

  <arg name="nominal_speed"     default="2"/>
  <arg name="lp_horizon"     default="5"/>
  <arg name="lp_period"     default="0.1"/>

  <arg name="gp_horizon"     default="30"/>
  <arg name="gp_period"     default="0.4"/>

  <arg name="planning_d/planning_dt"     default="0.1"/> <!--?-->

  <arg name="gp_z_min" value = "0.5"/>
  <arg name="gp_z_max" value = "1.0"/>

  <arg name = "goal/x"  default = "30"/> <!--in world frame -->
  <arg name = "goal/y" default = "73"/> <!--in world frame -->

  <group ns="atypical_planning_test">
    <rosparam file="$(find atypical_driving)/param/MPC_weight.yaml"/>
  </group>


    <!--   OccupancyGrid  -->
     <include file = "$(find atypical_driving)/launch/occupancy2d/costmap_2d.launch">
         <arg name = "play_bag" value = "false"/>
         <arg name = "use_sim_time" value="$(arg use_sim_time)"/>
         <arg name = "rviz" value = "false"/>
         <arg name = "occupancy_frame_id" value = "$(arg occu_frame_id)"/>
         <arg name = "lidar_frame_id" value = "$(arg lidar_frame_id)"/>
         <arg name = "pcl_topic" value = "$(arg pcl_topic)"/>
         <arg name = "cost_map_min_z" value = "0.1"/>
         <arg name = "cost_map_max_z" value = "1.0"/>
     </include>


<!-- Node start-->


    <!--2. client-->
    <node pkg="atypical_driving" type="integration_client" name="atypical_driving_client" output="screen">
        <param name = "obstacle_radius_x" value="1.0"/>
        <param name = "obstacle_radius_y" value="0.5"/>
    </node>



    <!--3. server-->
    <include file = "$(find atypical_driving)/launch/integration_server.launch" >
        <arg name = "world_frame_id" value = "$(arg world_frame_id)"/>
        <arg name = "snu_frame_id" value = "$(arg snu_frame_id)"/>
        <arg name = "occu_frame_id" value = "$(arg occu_frame_id)"/>
        <arg name = "car_base_frame_id" value = "$(arg car_base_frame_id)"/>
        <arg name = "detected_object_frame_id" value = "$(arg detected_object_frame_id)"/>

        <arg name = "lidar_frame_id" value = "$(arg lidar_frame_id)"/>
        <arg name = "lane_csv_file" value = "$(arg lane_csv_file)"/>

        <arg name = "goal/x" value = "$(arg goal/x)"/>
        <arg name = "goal/y" value = "$(arg goal/y)"/>

    </include>


  <node pkg="rviz" type="rviz" name="rviz" args="-d $(find atypical_driving)/launch/rviz_config/config.rviz" output="log" />

<!-- Nodes End -->
</launch>
